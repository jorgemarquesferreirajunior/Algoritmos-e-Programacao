/* Main.c file generated by New Project wizard
7.
 */

#include <p18f4450.h>
#include <delays.h>

#pragma config FOSC = HS
#pragma config WDT = OFF
#pragma config MCLRE = OFF

#define BT00	PORTAbits.RA0
#define BT01	PORTAbits.RA1
#define SIRENE 	PORTAbits.RA2
#define LED	PORTAbits.RA3

int estadoAnteriorBT00 = 1;
int estadoAnteriorBT01 = 1;
int flagBT00 = 0;
int flagBT01 = 0;

void atualiza_flag_BT00(){
   if(BT00 == 1 && !estadoAnteriorBT00 == 1){
	 flagBT00 = 1;
      }
      estadoAnteriorBT00 = BT00;
   }
void atualiza_flag_BT01(){
   if(BT01 == 1 && !estadoAnteriorBT01 == 1){
	 flagBT01 = 1;
      }
      estadoAnteriorBT01 = BT01;
   }
   
void delay_ms(unsigned int tempo){
   while(tempo > 0){
      atualiza_flag_BT00();
      atualiza_flag_BT01();
      Delay100TCYx(10);
      tempo--;
      }
   }
   
void delay_bounce(){
   delay_ms(30);
   }


void pisca_LED(){
   LED = 1;
   delay_ms(1000);
   LED = 0;
   delay_ms(1000);
   atualiza_flag_BT00();
   atualiza_flag_BT01();
   }
void main(){ 
   PORTA = 0x00; LATA = 0x00; TRISA = 0x03;
   ADCON1 = 0x0F;
   
   while (1){
      atualiza_flag_BT00();
      atualiza_flag_BT01();
      
      if(flagBT00 == 1){
	 SIRENE = 1;
      }
      
      if(flagBT00 == 1 && flagBT01 == 0){
	 pisca_LED();
	 delay_bounce();
      }
      
      if(flagBT00 == 1 && flagBT01 == 1){
	 SIRENE = 0;
	 flagBT00 = 0;
	 flagBT01 = 0;
      }
            
      delay_bounce();
   }
   
 }
